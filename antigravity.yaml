# antigravity.yaml
# Final production config for ai-lead-iq-2 frontend
# Used by Google Antigravity — must be in project root

version: 1

env:
  NODE_VERSION: "20"
  NPM_CONFIG_CACHE: "~/.npm"
  NODE_ENV: "production"
  # VITE_GEMINI_API_KEY: "Set this in your environment or .env file"
  # MINIMAX_API_KEY: "Set this in your environment or .env file"
  # MINIMAX_GROUP_ID: "Set this in your environment or .env file"

build:
  - name: Install Dependencies
    run: npm ci --cache=${NPM_CONFIG_CACHE}

  - name: Security Audit
    run: npm audit --audit-level=critical
    continueOnError: false

  - name: Run Linter (if configured)
    run: npm run lint || echo "No lint script — skipping"

  - name: Run Tests (if configured)
    run: npm run test || echo "No tests — skipping"

  - name: Build Application
    run: npm run build   # Outputs to /dist with VITE_ env vars injected

deploy:
  appType: client
  path: dist
  autoDeploy: true
  headers:
    - path: /*
      headers:
        Content-Security-Policy: "default-src 'self'; script-src 'self' https://generativelanguage.googleapis.com 'unsafe-inline'; connect-src 'self' https://generativelanguage.googleapis.com; img-src 'self' data:;"
        Strict-Transport-Security: "max-age=31536000; includeSubDomains"
        X-Content-Type-Options: "nosniff"

cache:
  - path: node_modules
  - path: ~/.npm
  - path: dist
